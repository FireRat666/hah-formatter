<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Card Formatter</title>
  <link rel="stylesheet" href="https://firer.at/pages/style.css" />
  <script src="https://firer.at/scripts/RandomBG.js"></script>
  <style>
  .info-text {
    font-size: 20px;
    line-height: 1.4 !important;
    display: block;
    /* margin: 0;  */
  }
  </style>
</head>
<body id="body">
  <p><b><div style="font-size: 35px;"><a href="https://cast.clrtd.com/api">CrCast</a> to Holograms Against Humanity Card Formatter</div></b></p>
  <form id="formatterForm">
    <p><label for="inputText" style="font-size: 30px;">Enter JSON:</label><br>
    <textarea id="inputText" class="url-form url-thing" style="font-size: 15px;" rows="10" cols="40" placeholder='Enter the card JSON here'></textarea><br>
    <button type="button" class="url-thing" style="font-size: 25px;" onclick="formatCards()">Format</button></p>
  </form>

  <b><div style="font-size: 30px;">Formatted Output</div></b>
  <textarea id="outputText" class="url-form url-thing" style="font-size: 15px;" rows="15" cols="40" readonly></textarea><div> </div><br>
  <span class="info-text"><div>
    INFO: Get the Code for a Deck from <a href="https://cast.clrtd.com/">cast.clrtd.com</a>.
    Then use the API URL & insert the deck code</div>
    <div>Example URL: https://api.crcast.cc/v1/cc/decks/<b><span style="color: #FFFF00">CODE</span></b>/cards/</div>
    Copy the RAW JSON Data and paste it into the above box, then click Format and you can copy the formatted JSON.
  </span><br><br>

  <script>
    function escapeQuotes(text) {
      // Escape all double quotes inside the text
      return text.replace(/"/g, '\\"');
    }

    function formatTextWithBlanksAndBreaks(textArray, maxLength = 25) {
      // Join array segments with the blank "_____"
      let combinedText = textArray.join(' _____ ');

      // Add line breaks (\n) to wrap lines to maxLength
      const words = combinedText.split(' ');
      let line = '';
      let formattedLines = [];

      words.forEach(word => {
        if (line.length + word.length + 1 > maxLength) {
          formattedLines.push(line.trim());
          line = word + ' ';
        } else {
          line += word + ' ';
        }
      });
      formattedLines.push(line.trim()); // Add the last line

      // Escape internal quotes after inserting line breaks
      return escapeQuotes(formattedLines.join('\\n')); // Use '\\n' for literal display
    }

    function formatCards() {
      const inputText = document.getElementById('inputText').value;
      try {
        const data = JSON.parse(inputText);

        // Process black cards
        const formattedBlack = data.calls.map(call =>
          `{"text": "${formatTextWithBlanksAndBreaks(call.text)}"}`
        ).join(',\n');

        // Process white cards
        const formattedWhite = data.responses.map(response =>
          `{"text": "${formatTextWithBlanksAndBreaks([response.text[0]])}"}`
        ).join(',\n');

        // Create final JSON structure
        const formattedOutput = `{\n"black": [\n${formattedBlack}\n],\n"white": [\n${formattedWhite}\n]\n}`;
        document.getElementById('outputText').value = formattedOutput;
      } catch (e) {
        alert('Invalid JSON format. Please correct your input.');
      }
    }
  </script>
</body>
</html>
